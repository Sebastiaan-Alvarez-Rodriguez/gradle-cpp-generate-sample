# Sample
This project exists to show how to configure Gradle when using the `cpp-application`/`cpp-library` plugin to compile generated sources + non-generated sources.


A generated source is a source (`.cpp`, `.h`, ...) which is generated by a Gradle task.  
In [`/app/build.gradle`](/app/build.gradle), we use Gradle to generate files `gen.cpp` and `gen.h` in directory `/app/src/main/generated/`.


# Problem
We require generated sources in our [`main.cpp`](/app/src/main/cpp/main.cpp).
We use
```c++
extern int lineno;

void testprint(Test);
```
These are defined in our generated code, making our existing code depend on generated code.  
The generated code itself also depends on existing code:
The `Test` class is used in generated sources, and defined in existing code.

So, generated sources depend on existing sources and viceversa.
If we want compilation to be successful, we need to generate sources and compile them with existing sources in one build. 

# Solution
The solution to this problem is pretty simple, once you find out how the pieces fit together.
### First Attempt
At first, we tried to use the following in our [`/app/build.gradle`](/app/build.gradle):
```groovy
build {
    dependsOn codeGeneration
}
```
> Note: Does *not* work!

The above snippet will generate the sources specified by the `codeGeneration` task.
However, it does not include the generated sources in the compilation process.
The sources are included only when building a second time.
This will work, but it is cumbersome to execute multiple tasks, especially for a simple project.

### Working Code
We understood that Gradle needs to know sooner about the generated source files for them to be included in the build process.

We use below snippet from our [`/app/build.gradle`](/app/build.gradle):
```groovy
tasks.withType(CppCompile).configureEach {
    dependsOn codeGeneration
}
```
This makes every source-compilation task depend on source generation.
Gradle now generates the sources before every task involving `C++` compilation.
This ensures we generate all sources before we start compiling.
Gradle actually compiles the generated sources using this technique.


# Environment
```
------------------------------------------------------------
Gradle 6.8.3
------------------------------------------------------------

Build time:   2021-02-22 16:13:28 UTC
Revision:     9e26b4a9ebb910eaa1b8da8ff8575e514bc61c78

Kotlin:       1.4.20
Groovy:       2.5.12
Ant:          Apache Ant(TM) version 1.10.9 compiled on September 27 2020
JVM:          11.0.10 (Ubuntu 11.0.10+9-Ubuntu-0ubuntu1.20.10)
OS:           Linux 5.8.0-48-generic amd64
```
We use `Gradle 6.8.3` for this example, which is the latest stable version at this time.
Versions greater than `Gradle 5.5.1` (July 2019) should work just fine too.